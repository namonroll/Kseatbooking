{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title|default:"常見問答 - K center" }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    /* --- 基礎 Body 和佈局樣式 --- */
    body {
        padding-top: 1.5rem;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
        transition: padding-left 0.3s ease-in-out;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background-color: rgb(235, 245, 251);
        min-height: 100vh;
        margin: 0;
        color: #333;
        display: flex;
        flex-direction: column;
    }
    body.menu-open {
        padding-left: calc(1.5rem + 270px);
    }
    .main-content-area {
        width: 100%;
        padding-left: 1rem; /* Adjusted slightly if needed */
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    /* --- 選單切換按鈕 --- */
    .choc-menu-toggle-btn-container {
        position: fixed; right: 25px; top: 25px; z-index: 1050;
    }
    #menu-toggle-btn {
        background-color: #fff; border: 1px solid #ced4da; color: #0d6efd;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 0.5rem 0.75rem; line-height: 1;
    }
    #menu-toggle-btn:hover { background-color: #e9ecef; }
    #menu-toggle-btn i { font-size: 1.25rem; }

    /* --- 側邊選單 CSS --- */
    #side-menu {
        position: fixed; top: 0; left: 0; width: 270px; height: 100%;
        background-color: #ffffff; padding: 20px; box-shadow: 0 0 15px rgba(0,0,0,0.1);
        z-index: 1000; overflow-y: auto; transform: translateX(-270px);
        transition: transform 0.35s cubic-bezier(0.25, 0.1, 0.25, 1);
        display: flex; flex-direction: column;
    }
    #side-menu.open { transform: translateX(0); }
    #side-menu .menu-header {
        padding-bottom: 15px; margin-bottom: 20px; border-bottom: 1px solid #dee2e6;
        display: flex; justify-content: space-between; align-items: center;
    }
    #side-menu .menu-header h5 { margin: 0; font-size: 1.2rem; font-weight: 600; color: #212529;}
    #close-menu-btn {
        font-size: 1.6rem; color: #6c757d; background: none; border: none; padding: 0 .5rem; opacity: 0.8;
    }
    #close-menu-btn:hover { color: #000; opacity: 1; }
    #side-menu .menu-button {
        display: flex; align-items: center; width: 100%; margin-bottom: 10px;
        padding: 12px 15px; text-align: left; font-size: 1rem; border-radius: 0.375rem;
        color: #495057; background-color: transparent; border: none;
        transition: background-color 0.2s ease, color 0.2s ease;
    }
    #side-menu .menu-button i { margin-right: 12px; font-size: 1.1rem; width: 20px; text-align: center; }
    #side-menu .menu-button:hover { background-color: #e9ecef; color: #0d6efd; }
    #side-menu .menu-button.active {
        background-color: #0d6efd;
        color: white;
        font-weight: 500;
    }
    #side-menu .menu-button.active i { color: white; }
    #logout-form-container { margin-top: auto; padding-top: 20px; border-top: 1px solid #dee2e6; }
    #side-menu .logout-button { color: #dc3545; }
    #side-menu .logout-button:hover { background-color: rgba(220, 53, 69, 0.1); color: #b02a37; }

    .dashboard-header {
        margin-bottom: 2rem;
        padding: 1.5rem 1.5rem; /* Increased padding slightly */
        background-color: #ffffff;
        border-radius: .5rem; /* Softer radius */
        box-shadow: 0 .125rem .35rem rgba(0,0,0,.06); /* Softer shadow */
    }
    .dashboard-header .header-title-group h1 {
        font-weight: 600; color: #212529; font-size: 1.85rem; margin-bottom: 0.35rem;
    }
    .dashboard-header .header-title-group p { color: #495057; margin-bottom: 0; font-size: 1.05rem; }

    /* --- REFINED STYLES for left panel buttons --- */
    .custom-left-panel-button {
        color: white; padding: 0.9rem 1.4rem; font-size: 1.1rem; font-weight: 500;
        border-radius: 0.5rem; text-align: left; display: flex; align-items: center;
        transition: transform 0.25s cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 0.25s cubic-bezier(0.25, 0.1, 0.25, 1), background 0.3s ease;
        border: none; text-decoration: none; position: relative; overflow: hidden;
    }
    .custom-left-panel-button i {
        font-size: 1.4rem; margin-right: 0.85rem;
        transition: transform 0.25s cubic-bezier(0.25, 0.1, 0.25, 1);
    }

    .btn-rules {
        background: linear-gradient(140deg, #4c8df7, #2a74e9);
        box-shadow: 0 4px 10px -3px rgba(42, 116, 233, 0.45), 0 2px 3px -2px rgba(0, 0, 0, 0.08);
    }
    .btn-rules:hover {
        background: linear-gradient(140deg, #5b9eff, #3a84f9);
        color: white; transform: translateY(-4px) scale(1.025);
        box-shadow: 0 7px 16px -4px rgba(42, 116, 233, 0.5), 0 4px 5px -2px rgba(0,0,0,0.1), 0 0 0 3px rgba(76, 141, 247, 0.35); /* Added glow */
    }
    .btn-rules:hover i { transform: scale(1.12) rotate(-6deg); }
    .custom-left-panel-button.btn-rules.active {
        background: linear-gradient(140deg, #3a84f9, #1a64d9);
        box-shadow: 0 7px 16px -4px rgba(42, 116, 233, 0.6), 0 4px 5px -2px rgba(0,0,0,0.15), 0 0 0 3px rgba(76, 141, 247, 0.5); /* Added glow */
        transform: translateY(-2px) scale(1.01);
    }

    .btn-faq {
        background: linear-gradient(140deg, #b09bf8, #8a6fdf);
        box-shadow: 0 4px 10px -3px rgba(138, 111, 223, 0.45), 0 2px 3px -2px rgba(0, 0, 0, 0.08);
    }
    .btn-faq:hover {
        background: linear-gradient(140deg, #bfaff9, #9a7ff0);
        color: white; transform: translateY(-4px) scale(1.025);
        box-shadow: 0 7px 16px -4px rgba(138, 111, 223, 0.5), 0 4px 5px -2px rgba(0,0,0,0.1), 0 0 0 3px rgba(176, 155, 248, 0.35); /* Added glow */
    }
    .btn-faq:hover i { transform: scale(1.12) rotate(6deg); }
    .custom-left-panel-button.btn-faq.active {
        background: linear-gradient(140deg, #9a7ff0, #7a5fcf);
        box-shadow: 0 7px 16px -4px rgba(138, 111, 223, 0.6), 0 4px 5px -2px rgba(0,0,0,0.15), 0 0 0 3px rgba(176, 155, 248, 0.5); /* Added glow */
        transform: translateY(-2px) scale(1.01);
    }

    /* --- NEW/MODIFIED: Styles for the Green Main Menu Button --- */
    .btn-main-menu {
        background: linear-gradient(140deg, #34d058, #28a745); /* Green gradient */
        box-shadow: 0 4px 10px -3px rgba(40, 167, 69, 0.45), 0 2px 3px -2px rgba(0, 0, 0, 0.08);
    }
    .btn-main-menu:hover {
        background: linear-gradient(140deg, #40de63, #34d058); /* Lighter green on hover */
        color: white;
        transform: translateY(-4px) scale(1.025);
        box-shadow: 0 7px 16px -4px rgba(40, 167, 69, 0.5), 0 4px 5px -2px rgba(0,0,0,0.1), 0 0 0 3px rgba(64, 222, 99, 0.35); /* Green glow */
    }
    .btn-main-menu:hover i {
        transform: scale(1.12) rotate(-3deg);
    }
    /* No active state for main menu button unless it navigates to a distinct "main menu" page that would set it active */

    /* --- Toast styles (unchanged) --- */
    .toast-container-custom {
        position: fixed; top: 20px; right: 20px; z-index: 1100;
    }
    /* ... (other toast styles remain the same) ... */

    .site-footer {
        background-color: #343a40;
        color: #f8f9fa;
        padding: 2.5rem 0;
        margin-top: 3rem;
        font-size: 0.9rem;
        text-align: center;
    }
    .site-footer .container {
        display: flex; flex-direction: column; align-items: center;
    }
    .site-footer p { margin-bottom: 0.5rem; }

    /* --- NEW/MODIFIED: REFINED ACCORDION STYLES --- */
    .accordion-item {
        background-color: #fff;
        border: 1px solid #e0e0e0; /* Lighter border */
        border-radius: 0.5rem; /* Rounded corners */
        margin-bottom: 1rem; /* Space between items */
        box-shadow: 0 2px 8px rgba(0,0,0,0.06); /* Softer shadow */
        overflow: hidden; /* Ensures children respect border-radius */
    }

    .accordion-header { /* No specific style needed for header div usually */
        margin-bottom: 0; /* Reset margin */
    }

    .accordion-button {
        font-weight: 500;
        color: #212529; /* Darker text for better readability */
        background-color: #f8f9fa; /* Light grey background for header */
        padding: 1rem 1.25rem;
        border-radius: 0; /* Remove default radius as item has it */
        transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    }

    .accordion-button:not(.collapsed) {
        color: #0d6efd; /* Bootstrap primary color for active accordion button */
        background-color: #e7f1ff; /* Light blue background for active */
        box-shadow: inset 0 -1px 0 rgba(0,0,0,.125); /* Subtle inner shadow */
    }

    .accordion-button:focus {
        z-index: 3;
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); /* Bootstrap focus ring */
    }

    .accordion-button:hover {
        background-color: #e9ecef; /* Slightly darker on hover */
        z-index: 2;
    }

    /* Customizing the accordion button's arrow (chevron) */
    .accordion-button::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23212529'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
        transition: transform .2s ease-in-out; /* Smooth rotation */
    }
    .accordion-button:not(.collapsed)::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%230c63e4'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
        transform: rotate(-180deg);
    }

    .accordion-body {
        padding: 1.25rem;
        background-color: #fff; /* White background for content area */
        font-size: 0.95rem;
        line-height: 1.6;
    }
    /* --- END REFINED ACCORDION STYLES --- */

</style>
</head>
<body {% if request.resolver_match.url_name != 'dashboard' and request.COOKIES.menu_open_cookie == 'true' %}class="menu-open"{% endif %}>

<div class="toast-container-custom" id="toast-container-dashboard"></div>

<div id="side-menu" {% if request.resolver_match.url_name != 'dashboard' and request.COOKIES.menu_open_cookie == 'true' %}class="open"{% endif %}>
    <div class="menu-header">
        <h5>預約功能</h5>
        <button id="close-menu-btn" type="button" aria-label="關閉選單">×</button>
    </div>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:dashboard' %}'">
        <i class="bi bi-house-door-fill"></i> 主選單
    </button>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'rules' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:rules' %}'">
        <i class="bi bi-journal-text"></i> 預約辦法
    </button>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'faq' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:faq' %}'">
        <i class="bi bi-question-circle-fill"></i> 常見問題
    </button>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'welcome' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:welcome' %}'">
        <i class="bi bi-grid-1x2-fill"></i> 即時座位圖
    </button>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'res_time' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:res_time' %}'">
        <i class="bi bi-calendar-plus-fill"></i> 預約座位
    </button>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'reminds' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:reminds' %}'">
        <i class="bi bi-exclamation-octagon-fill"></i> 檢舉系統
    </button>
    <button type="button" class="menu-button {% if request.resolver_match.url_name == 'records' %}active{% endif %}"
            onclick="appSideMenuClose(); window.location.href='{% url 'seats:records' %}'">
        <i class="bi bi-person-lines-fill"></i> 個人紀錄
    </button>
    <div id="logout-form-container">
        <form id="logout-form-dashboard" method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="menu-button logout-button" onclick="appSideMenuClose();">
                <i class="bi bi-box-arrow-right"></i> 登出
            </button>
        </form>
    </div>
</div>

<div class="main-content-area">
    <div class="choc-menu-toggle-btn-container">
        <button id="menu-toggle-btn" type="button" class="btn btn-light btn-lg">
            <i class="bi bi-list"></i>
        </button>
    </div>

    <div class="container pt-3">
        <div class="dashboard-header">
            <div class="header-title-group">
                <h1>{{ page_title|default:"常見問答" }}</h1>
                <p class="lead">{{ welcome_message|default:"以下是您可能會遇到的問題與解答。" }}</p>
            </div>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-3" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        <div class="row mt-4">
            {# Left Panel - Buttons #}
            <div class="col-lg-4 col-md-5 mb-4 mb-md-0">
                <a href="{% url 'seats:rules' %}"
                    class="custom-left-panel-button btn-rules d-block mb-3 {% if request.resolver_match.url_name == 'rules' %}active{% endif %}">
                    <i class="bi bi-journal-text"></i>預約辦法
                </a>
                <a href="{% url 'seats:faq' %}"
                    class="custom-left-panel-button btn-faq d-block mb-3 {% if request.resolver_match.url_name == 'faq' %}active{% endif %}">
                    <i class="bi bi-question-circle-fill"></i>常見問題
                </a>
                {# --- NEW: Green "Back to Main Menu" Button --- #}
                <a href="{% url 'seats:dashboard' %}"
                    class="custom-left-panel-button btn-main-menu d-block"> {# No mb-3 if it's the last one, or add if more follow #}
                    <i class="bi bi-house-door-fill"></i>回主選單
                </a>
            </div>

            {# Right Panel - FAQ Accordion Content #}
            <div class="col-lg-8 col-md-7">
                {# Card removed as accordion items are now styled like cards #}
                <div class="accordion" id="faqAccordion">
                    {# --- START: Actual accordion items --- #}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faqHeadingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseOne" aria-expanded="true" aria-controls="faqCollapseOne">
                                如何預約座位？
                            </button>
                        </h2>
                        <div id="faqCollapseOne" class="accordion-collapse collapse show" aria-labelledby="faqHeadingOne" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                您可以透過「K 書中心座位管理系統」進行線上預約。選擇您想要的區域、日期與時段，確認後即可完成預約。
                                詳細步驟請參考「預約辦法」頁面。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faqHeadingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseTwo" aria-expanded="false" aria-controls="faqCollapseTwo">
                                預約時長有限制嗎？
                            </button>
                        </h2>
                        <div id="faqCollapseTwo" class="accordion-collapse collapse" aria-labelledby="faqHeadingTwo" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                是的，每次登記以 1 小時為單位，每筆借用以 3 小時為上限。同一使用者在同一時段僅可登記一個座位。
                                使用時間結束後，若無他人預約，可再次登記使用。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faqHeadingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseThree" aria-expanded="false" aria-controls="faqCollapseThree">
                                如果預約了但遲到會怎麼樣？
                            </button>
                        </h2>
                        <div id="faqCollapseThree" class="accordion-collapse collapse" aria-labelledby="faqHeadingThree" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                借用者應於借用時間開始後 15 分鐘內入座。若逾時未入座，該座位可能會被系統自動釋放或被他人舉報，
                                導致該座位開放給下一位預約者使用。您的預約紀錄也可能受到影響。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faqHeadingFour">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseFour" aria-expanded="false" aria-controls="faqCollapseFour">
                                K 書中心可以飲食嗎？
                            </button>
                        </h2>
                        <div id="faqCollapseFour" class="accordion-collapse collapse" aria-labelledby="faqHeadingFour" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                閱覽室應保持清潔，禁止吸煙及飲食 (可飲用有蓋容器裝的飲品)。請共同維護 K 書中心的整潔環境。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faqHeadingFive">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapseFive" aria-expanded="false" aria-controls="faqCollapseFive">
                                如果發現有人違規佔位怎麼辦？
                            </button>
                        </h2>
                        <div id="faqCollapseFive" class="accordion-collapse collapse" aria-labelledby="faqHeadingFive" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                您可以透過「檢舉系統」回報違規情況。請提供相關座位號碼及事證，管理人員將會進行查核處理。
                                請勿私自移動他人佔位物品。
                            </div>
                        </div>
                    </div>
                    {# --- END: Actual accordion items --- #}
                </div>

                {# --- 回首頁按鈕 removed --- #}

            </div>
        </div>
    </div>
</div>

<footer class="site-footer">
    <div class="container">
        <p>地址: (320317) 桃園市中壢區中大路300號</p>
        <p>總機電話: 03-4267126</p>
        <p>緊急事件聯絡電話:</p>
        <p>03-4267144 (校內分機57119-駐警隊)</p>
    </div>
</footer>

<script>
    // ... (JavaScript remains the same) ...
    let appSideMenuEl = null;
    let appBodyEl = null;

    function appSideMenuClose() {
        if (appSideMenuEl && appBodyEl) {
            appSideMenuEl.classList.remove('open');
            appBodyEl.classList.remove('menu-open');
            document.cookie = "menu_open_cookie=false;path=/;SameSite=Lax";
        }
    }

    function appSideMenuOpen() {
        if (appSideMenuEl && appBodyEl) {
            appSideMenuEl.classList.add('open');
            appBodyEl.classList.add('menu-open');
            document.cookie = "menu_open_cookie=true;path=/;SameSite=Lax";
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        appSideMenuEl = document.getElementById('side-menu');
        appBodyEl = document.body;

        const menuToggleBtn = document.getElementById('menu-toggle-btn');
        const closeMenuBtnInsideMenu = document.getElementById('close-menu-btn');

        const currentUrlName = "{{ request.resolver_match.url_name|default:'' }}";
        const isDashboardPage = currentUrlName === "dashboard";

        if (isDashboardPage) {
            if (appBodyEl.classList.contains('menu-open') || (appSideMenuEl && appSideMenuEl.classList.contains('open'))) {
                appSideMenuClose();
            }
        }

        if (menuToggleBtn) {
            menuToggleBtn.addEventListener('click', function() {
                if (appSideMenuEl && appSideMenuEl.classList.contains('open')) {
                    appSideMenuClose();
                } else {
                    appSideMenuOpen();
                }
            });
        }

        if (closeMenuBtnInsideMenu) {
            closeMenuBtnInsideMenu.addEventListener('click', function() {
                appSideMenuClose();
            });
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>